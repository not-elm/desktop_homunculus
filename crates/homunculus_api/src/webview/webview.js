var __IIFE__=function(t){"use strict";const e="http://localhost:3100",s=async t=>{const s=await fetch(`${e}/${t}`);return await a(s),s},n=async(t,s)=>{const n=await fetch(`${e}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s??{})});return await a(n),n},i=async(t,s)=>{const n=await fetch(`${e}/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s??{})});return await a(n),n},a=async t=>{if(!t.ok)throw new Error(`url: ${t.url}\nStatus ${t.statusText}\n${await t.text()}`)};var r,o;t.display=void 0,(r=t.display||(t.display={})).findAll=async()=>{const t=await s("display");return await t.json()},r.printDisplays=t=>{Array.isArray(t)?t.forEach(r.printDisplays):console.log(JSON.stringify({id:t.id,title:t.title,frame:{min:JSON.stringify(t.frame.min),max:JSON.stringify(t.frame.max)}},null,2))},t.effects=void 0,(o=t.effects||(t.effects={})).sound=async t=>{await n(`effects/sound/${t}`)},o.stamp=async(t,e)=>{await n(`effects/stamp/${t}`,e)};var c,h,l;t.preferences=void 0,(c=t.preferences||(t.preferences={})).load=async t=>{const e=await s(`preferences/${t}`);return await e.json()},c.save=async(t,e)=>{await i(`preferences/${t}`,e)},t.script=void 0,(t.script||(t.script={})).callJavascript=async t=>{await n(`script/js/${t}`)},t.settings=void 0,(h=t.settings||(t.settings={})).fps=async()=>{const t=await s("settings/fps");return Number(await t.text())},h.setFps=async t=>{await i("settings/fps",t)},h.isSafeMode=async()=>{const t=await s("settings/safe-mode");return t.ok&&"true"===await t.text()},h.setSafeMode=async t=>{await i("settings/safe-mode",t)},t.shadowPanel=void 0,(l=t.shadowPanel||(t.shadowPanel={})).alpha=async()=>{const t=await s("shadow-panel/alpha");return Number(await t.text())},l.setAlpha=async t=>{await i("shadow-panel/alpha",{alpha:t})};class d extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}}function u(t){}function w(t){if("function"==typeof t)throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=u,onError:s=u,onRetry:n=u,onComment:i}=t;let a,r="",o=!0,c="",h="";function l(t){if(""===t)return c.length>0&&e({id:a,event:h||void 0,data:c.endsWith("\n")?c.slice(0,-1):c}),a=void 0,c="",void(h="");if(t.startsWith(":"))return void(i&&i(t.slice(t.startsWith(": ")?2:1)));const s=t.indexOf(":");if(-1!==s){const e=t.slice(0,s),n=" "===t[s+1]?2:1;return void w(e,t.slice(s+n),t)}w(t,"",t)}function w(t,e,i){switch(t){case"event":h=e;break;case"data":c=`${c}${e}\n`;break;case"id":a=e.includes("\0")?void 0:e;break;case"retry":/^\d+$/.test(e)?n(parseInt(e,10)):s(new d(`Invalid \`retry\` value: "${e}"`,{type:"invalid-retry",value:e,line:i}));break;default:s(new d(`Unknown field "${t.length>20?`${t.slice(0,20)}â€¦`:t}"`,{type:"unknown-field",field:t,value:e,line:i}))}}return{feed:function(t){const e=o?t.replace(/^\xEF\xBB\xBF/,""):t,[s,n]=function(t){const e=[];let s="",n=0;for(;n<t.length;){const i=t.indexOf("\r",n),a=t.indexOf("\n",n);let r=-1;if(-1!==i&&-1!==a?r=Math.min(i,a):-1!==i?r=i:-1!==a&&(r=a),-1===r){s=t.slice(n);break}{const s=t.slice(n,r);e.push(s),n=r+1,"\r"===t[n-1]&&"\n"===t[n]&&n++}}return[e,s]}(`${r}${e}`);for(const t of s)l(t);r=n,o=!1},reset:function(t={}){r&&t.consume&&l(r),o=!0,a=void 0,c="",h="",r=""}}}class p extends Event{constructor(t,e){var s,n;super(t),this.code=null!=(s=null==e?void 0:e.code)?s:void 0,this.message=null!=(n=null==e?void 0:e.message)?n:void 0}[Symbol.for("nodejs.util.inspect.custom")](t,e,s){return s(v(this),e)}[Symbol.for("Deno.customInspect")](t,e){return t(v(this),e)}}function f(t){return t instanceof Error?"errors"in t&&Array.isArray(t.errors)?t.errors.map(f).join(", "):"cause"in t&&t.cause instanceof Error?`${t}: ${f(t.cause)}`:t.message:`${t}`}function v(t){return{type:t.type,message:t.message,code:t.code,defaultPrevented:t.defaultPrevented,cancelable:t.cancelable,timeStamp:t.timeStamp}}var y,m,g,E,$,b,S,x,N,k,T,O,C,M,W,I,L,j,P,D,A,R,U,J=t=>{throw TypeError(t)},_=(t,e,s)=>e.has(t)||J("Cannot "+s),G=(t,e,s)=>(_(t,e,"read from private field"),s?s.call(t):e.get(t)),B=(t,e,s)=>e.has(t)?J("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),F=(t,e,s,n)=>(_(t,e,"write to private field"),e.set(t,s),s),V=(t,e,s)=>(_(t,e,"access private method"),s);class H extends EventTarget{constructor(t,e){var s,n;super(),B(this,M),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,B(this,y),B(this,m),B(this,g),B(this,E),B(this,$),B(this,b),B(this,S),B(this,x,null),B(this,N),B(this,k),B(this,T,null),B(this,O,null),B(this,C,null),B(this,I,async t=>{var e;G(this,k).reset();const{body:s,redirected:n,status:i,headers:a}=t;if(204===i)return V(this,M,A).call(this,"Server sent HTTP 204, not reconnecting",204),void this.close();if(F(this,g,n?new URL(t.url):void 0),200!==i)return void V(this,M,A).call(this,`Non-200 status code (${i})`,i);if(!(a.get("content-type")||"").startsWith("text/event-stream"))return void V(this,M,A).call(this,'Invalid content type, expected "text/event-stream"',i);if(G(this,y)===this.CLOSED)return;F(this,y,this.OPEN);const r=new Event("open");if(null==(e=G(this,C))||e.call(this,r),this.dispatchEvent(r),"object"!=typeof s||!s||!("getReader"in s))return V(this,M,A).call(this,"Invalid response body, expected a web ReadableStream",i),void this.close();const o=new TextDecoder,c=s.getReader();let h=!0;do{const{done:t,value:e}=await c.read();e&&G(this,k).feed(o.decode(e,{stream:!t})),t&&(h=!1,G(this,k).reset(),V(this,M,R).call(this))}while(h)}),B(this,L,t=>{F(this,N,void 0),"AbortError"!==t.name&&"aborted"!==t.type&&V(this,M,R).call(this,f(t))}),B(this,P,t=>{"string"==typeof t.id&&F(this,x,t.id);const e=new MessageEvent(t.event||"message",{data:t.data,origin:G(this,g)?G(this,g).origin:G(this,m).origin,lastEventId:t.id||""});G(this,O)&&(!t.event||"message"===t.event)&&G(this,O).call(this,e),this.dispatchEvent(e)}),B(this,D,t=>{F(this,b,t)}),B(this,U,()=>{F(this,S,void 0),G(this,y)===this.CONNECTING&&V(this,M,W).call(this)});try{if(t instanceof URL)F(this,m,t);else{if("string"!=typeof t)throw new Error("Invalid URL");F(this,m,new URL(t,function(){const t="document"in globalThis?globalThis.document:void 0;return t&&"object"==typeof t&&"baseURI"in t&&"string"==typeof t.baseURI?t.baseURI:void 0}()))}}catch{throw function(t){const e=globalThis.DOMException;return"function"==typeof e?new e(t,"SyntaxError"):new SyntaxError(t)}("An invalid or illegal string was specified")}F(this,k,w({onEvent:G(this,P),onRetry:G(this,D)})),F(this,y,this.CONNECTING),F(this,b,3e3),F(this,$,null!=(s=null==e?void 0:e.fetch)?s:globalThis.fetch),F(this,E,null!=(n=null==e?void 0:e.withCredentials)&&n),V(this,M,W).call(this)}get readyState(){return G(this,y)}get url(){return G(this,m).href}get withCredentials(){return G(this,E)}get onerror(){return G(this,T)}set onerror(t){F(this,T,t)}get onmessage(){return G(this,O)}set onmessage(t){F(this,O,t)}get onopen(){return G(this,C)}set onopen(t){F(this,C,t)}addEventListener(t,e,s){const n=e;super.addEventListener(t,n,s)}removeEventListener(t,e,s){const n=e;super.removeEventListener(t,n,s)}close(){G(this,S)&&clearTimeout(G(this,S)),G(this,y)!==this.CLOSED&&(G(this,N)&&G(this,N).abort(),F(this,y,this.CLOSED),F(this,N,void 0))}}y=new WeakMap,m=new WeakMap,g=new WeakMap,E=new WeakMap,$=new WeakMap,b=new WeakMap,S=new WeakMap,x=new WeakMap,N=new WeakMap,k=new WeakMap,T=new WeakMap,O=new WeakMap,C=new WeakMap,M=new WeakSet,W=function(){F(this,y,this.CONNECTING),F(this,N,new AbortController),G(this,$)(G(this,m),V(this,M,j).call(this)).then(G(this,I)).catch(G(this,L))},I=new WeakMap,L=new WeakMap,j=function(){var t;const e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...G(this,x)?{"Last-Event-ID":G(this,x)}:void 0},cache:"no-store",signal:null==(t=G(this,N))?void 0:t.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},P=new WeakMap,D=new WeakMap,A=function(t,e){var s;G(this,y)!==this.CLOSED&&F(this,y,this.CLOSED);const n=new p("error",{code:e,message:t});null==(s=G(this,T))||s.call(this,n),this.dispatchEvent(n)},R=function(t,e){var s;if(G(this,y)===this.CLOSED)return;F(this,y,this.CONNECTING);const n=new p("error",{code:e,message:t});null==(s=G(this,T))||s.call(this,n),this.dispatchEvent(n),F(this,S,setTimeout(G(this,U),G(this,b)))},U=new WeakMap,H.CONNECTING=0,H.OPEN=1,H.CLOSED=2;class q{eventSource;constructor(t){this.eventSource=t}on(t,e){this.eventSource.addEventListener(t,t=>{e(JSON.parse(t.data))})}close(){this.eventSource.close()}[Symbol.dispose](){this.eventSource.close()}}class z{entity;constructor(t){this.entity=t}events(){const t=`${e}/vrm/${this.entity}/events`;return new q(new H(t))}async state(){const t=await this.fetch("state");return(await t.json()).state}async setState(t){await this.put("state",{state:t})}async name(){const t=await this.fetch("name");return(await t.json()).name}async transform(t){const e=t?`transform?bone=${t}`:"transform",s=await this.fetch(e);return await s.json()}async setTransform(t){await this.put("transform",t)}async vrma(t){const e=await s(`vrm/${this.entity}/vrma/${t}`),n=Number(await e.text());return new Q(n)}async speakOnVoiceVox(t,e){return(await this.post("speak/voicevox",{text:t,...e})).body.pipeThrough(new TextDecoderStream)}static async spawn(t,s){const n=await fetch(`${e}/vrm/spawn`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({asset:t,...s})});if(!n.ok)throw new Error(`Status ${n.statusText}\n${await n.text()}`);return new z(Number(await n.text()))}static async findByName(t){const s=await fetch(`${e}/vrm?name=${t}`);if(!s.ok)throw new Error(`Status ${s.statusText}\n${await s.text()}`);return new z(Number(await s.text()))}static async waitLoadedByName(t){const s=await fetch(`${e}/vrm/wait-load?name=${t}`);if(!s.ok)throw new Error(`Status ${s.statusText}\n${await s.text()}`);return new z(Number(await s.text()))}static async findAllMetadata(){const t=await fetch(`${e}/vrm/all`);if(!t.ok)throw new Error(`Status ${t.statusText}\n${await t.text()}`);return await t.json()}static async findAll(){return(await z.findAllMetadata()).map(t=>new z(t.entity))}async fetch(t){return await s(`vrm/${this.entity}/${t}`)}async post(t,e){return await n(`vrm/${this.entity}/${t}`,e)}async put(t,e){await i(`vrm/${this.entity}/${t}`,e)}}class K{args;constructor(t){this.args=t}static forever(){return new K({type:"forever"})}static count(t){return new K({type:"count",count:t})}static never(){return new K({type:"never"})}}class Q{entity;constructor(t){this.entity=t}async play(t){await i(`vrma/${this.entity}/play`,t)}async stop(){await i(`vrma/${this.entity}/stop`)}}class X{entity;constructor(t){this.entity=t}async close(){await n(`webview/${this.entity}/close`)}static async open(t,e){const s=await n(`webview/${t}/open`,e);return new X(Number(await s.text()))}}return t.Repeat=K,t.Vrm=z,t.VrmEventSource=q,t.Vrma=Q,t.Webview=X,t.host=e,t.httpGet=s,t.httpPost=n,t.httpPut=i,t.runtime=()=>"undefined"!=typeof window&&void 0!==window.EventSource?"browser":"undefined"!=typeof process&&process.versions?.node?"nodejs":"deno",t.sleep=t=>new Promise(e=>setTimeout(e,t)),t}({});Object.defineProperty(window,"api",{value:__IIFE__});
